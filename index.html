<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CAPITAL // OS v17.4 [OPTIMIZED]</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;800&family=Space+Grotesk:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* ‚îÄ‚îÄ‚îÄ NIGHT MODE (DEFAULT) ‚îÄ‚îÄ‚îÄ */
            --bg-void: #050505;
            --bg-panel: #0a0a0a;
            --bg-card: #111;
            --bg-hover: #1a1a1a;
            
            --border: #333;
            --border-active: #555;
            
            --text-main: #e0e0e0;
            --text-dim: #888;
            --text-inv: #000;

            /* LOGICAL COLOR SYSTEM */
            --cyan: #00f0ff;  /* SYSTEM / STRUCTURE */
            --cyan-dim: rgba(0, 240, 255, 0.1);
            
            --gold: #ffd700;  /* MASTERY / HUMAN INPUT */
            --gold-dim: rgba(255, 215, 0, 0.05);
            
            --green: #00FF7F; /* GAIN */
            
            /* FAILSAFE / EMERGENCY VARS */
            --red: #ff2a6d;   
            --red-dim: rgba(255, 42, 109, 0.1);
            --red-glow: rgba(255, 42, 109, 0.4);
            
            --font-head: 'Space Grotesk', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        /* ‚îÄ‚îÄ‚îÄ DAY MODE ‚îÄ‚îÄ‚îÄ */
        body.light-mode {
            --bg-void: #e0e0e0; --bg-panel: #f0f0f0; --bg-card: #ffffff; --bg-hover: #e5e5e5;
            --border: #ccc; --border-active: #999;
            --text-main: #111; --text-dim: #555; --text-inv: #fff;
            --cyan: #0066ff; --cyan-dim: rgba(0, 102, 255, 0.1);
            --gold: #d4a000; --gold-dim: rgba(212, 160, 0, 0.05);
            --green: #00c853; 
            --red: #d50000; --red-dim: rgba(213, 0, 0, 0.05); --red-glow: rgba(213, 0, 0, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg-void); color: var(--text-main);
            font-family: var(--font-head); font-size: 15px; line-height: 1.5;
            height: 100vh; height: 100dvh; display: flex; overflow: hidden;
            transition: background 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), color 0.4s;
        }

        /* ‚îÄ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ‚îÄ */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--bg-void); }
        ::-webkit-scrollbar-thumb { background: var(--border-active); border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--cyan); }

        /* ‚îÄ‚îÄ‚îÄ CONFIRMATION MODAL ‚îÄ‚îÄ‚îÄ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 999;
            display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .modal-overlay.active { display: flex; opacity: 1; }
        
        .modal-box {
            background: var(--bg-panel); border: 1px solid var(--border);
            width: 90%; max-width: 450px; padding: 30px; text-align: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5); transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            border-left: 4px solid var(--cyan);
        }
        .modal-overlay.active .modal-box { transform: scale(1); }
        
        .modal-box.danger { border-left-color: var(--red); border-color: var(--red); box-shadow: 0 0 30px var(--red-dim); }
        
        .modal-title { font-family: var(--font-code); font-size: 18px; font-weight: 800; margin-bottom: 15px; letter-spacing: 1px; text-transform: uppercase; }
        .modal-box.danger .modal-title { color: var(--red); }
        .modal-box.standard .modal-title { color: var(--cyan); }
        
        .modal-txt { color: var(--text-dim); font-size: 14px; margin-bottom: 25px; line-height: 1.6; }
        
        .modal-actions { display: flex; gap: 10px; justify-content: center; }
        
        .modal-btn {
            font-family: var(--font-code); font-size: 12px; font-weight: 700; padding: 10px 20px;
            border: 1px solid var(--border); background: transparent; color: var(--text-dim);
            cursor: pointer; text-transform: uppercase; transition: 0.2s;
        }
        .modal-btn:hover { color: var(--text-main); border-color: var(--text-main); }
        
        .modal-btn.confirm-danger { border-color: var(--red); color: var(--red); background: var(--red-dim); }
        .modal-btn.confirm-danger:hover { background: var(--red); color: #fff; }
        
        .modal-btn.confirm-standard { border-color: var(--cyan); color: var(--cyan); background: var(--cyan-dim); }
        .modal-btn.confirm-standard:hover { background: var(--cyan); color: #000; }

        /* ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ */
        .sidebar {
            width: 260px; background: var(--bg-panel); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; flex-shrink: 0; z-index: 100;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(2px); z-index: 90;
            display: none; opacity: 0; transition: opacity 0.3s ease;
        }
        .sidebar-overlay.active { display: block; opacity: 1; }

        .brand {
            height: 70px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 25px; border-bottom: 1px solid var(--border); font-family: var(--font-code);
            font-weight: 800; font-size: 14px; letter-spacing: 1px; color: var(--text-main); white-space: pre; 
        }
        .brand span { color: var(--gold); }
        
        .live-dot {
            width: 8px; height: 8px; background: var(--green); border-radius: 50%; 
            margin-right: 12px; box-shadow: 0 0 10px var(--green); animation: blink 2s infinite;
        }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        .nav-list { flex: 1; overflow-y: auto; padding: 25px 0; }
        .nav-label {
            padding: 0 25px 8px; font-family: var(--font-code); font-size: 10px; color: var(--text-dim);
            text-transform: uppercase; letter-spacing: 1px; margin-top: 25px; font-weight: 700;
        }

        .nav-btn {
            width: 100%; text-align: left; background: transparent; border: none;
            padding: 12px 25px; color: var(--text-dim); font-family: var(--font-head);
            font-size: 14px; font-weight: 500; cursor: pointer;
            border-left: 2px solid transparent; display: flex; align-items: center; justify-content: space-between;
            transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .nav-btn:hover { color: var(--text-main); background: var(--bg-hover); padding-left: 30px; }
        .nav-btn.active { color: var(--cyan); background: var(--cyan-dim); border-left-color: var(--cyan); font-weight: 700; }
        
        /* ‚îÄ‚îÄ‚îÄ FAILSAFE TOGGLE STYLES (STRICT CONTAINMENT) ‚îÄ‚îÄ‚îÄ */
        /* Only sidebar border turns red */
        body.failsafe-active .sidebar { border-right-color: var(--red); }
        
        /* The specific failsafe button logic */
        body.failsafe-active .nav-btn.failsafe-trigger { 
            color: var(--red) !important; 
            background: var(--red-dim) !important; 
            border-left-color: var(--red) !important;
            font-weight: 800;
        }
        
        body.failsafe-active .brand span { color: var(--red); }
        body.failsafe-active .live-dot { background: var(--red); box-shadow: 0 0 10px var(--red); }
        
        /* Force Red Scrollbar ONLY in Failsafe Mode */
        body.failsafe-active ::-webkit-scrollbar-thumb { background: var(--red); }

        .prog-tag {
            font-family: var(--font-code); font-size: 11px; padding: 2px 8px;
            background: transparent; color: var(--text-dim); border-radius: 4px; border: 1px solid var(--border);
            font-weight: 700; transition: 0.3s;
        }

        /* ‚îÄ‚îÄ‚îÄ MAIN AREA & ANIMATIONS ‚îÄ‚îÄ‚îÄ */
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        .top-bar {
            height: 70px; border-bottom: 1px solid var(--border); display: flex;
            justify-content: space-between; align-items: center; padding: 0 30px;
            background: var(--bg-panel); flex-shrink: 0; z-index: 10; position: relative;
        }
        
        .top-left-group { display: flex; align-items: center; gap: 15px; width: 200px; }
        .top-right-group { display: flex; align-items: center; gap: 15px; }
        
        .top-center { position: absolute; left: 50%; transform: translateX(-50%); display: flex; align-items: center; }

        /* ‚îÄ‚îÄ‚îÄ MISSION CONTROL BUTTON (UPDATED LOGIC) ‚îÄ‚îÄ‚îÄ */
        .db-btn {
            /* Base State: Visible, outlined, but quiet */
            background: transparent; 
            border: 1px solid var(--border-active); 
            color: var(--text-dim);
            font-family: var(--font-code); font-size: 14px; font-weight: 700;
            padding: 10px 30px; text-transform: uppercase; letter-spacing: 1.5px;
            cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 12px;
            border-radius: 100px; 
        }
        
        .db-btn:hover {
            border-color: var(--cyan); color: var(--cyan); background: var(--bg-hover);
            transform: translateY(-1px);
        }
        
        /* Active State: The "Permanent Glow" requested, only when on Dashboard */
        .db-btn.active {
            background: var(--cyan-dim); 
            border: 2px solid var(--cyan); 
            color: var(--cyan);
            font-weight: 800;
            padding: 12px 35px; /* Slight resize for emphasis */
            box-shadow: 0 0 15px var(--cyan-dim);
        }
        
        /* Strict Red Override only if Failsafe is active AND user is looking at dashboard/failsafe header */
        body.failsafe-active .db-btn.active {
            background: var(--red-dim) !important; 
            border-color: var(--red) !important; 
            color: var(--red) !important;
            box-shadow: 0 0 15px var(--red-dim) !important;
        }

        .db-btn span { font-size: 18px; transition: color 0.3s; }
        .db-btn.active span { color: var(--green); animation: pulse 2s infinite; }
        body.failsafe-active .db-btn.active span { color: var(--red) !important; }

        .mini-db-btn {
            background: transparent; border: 1px solid var(--border); color: var(--text-dim);
            font-family: var(--font-code); font-size: 11px; font-weight: 700;
            padding: 8px 16px; text-transform: uppercase; cursor: pointer; transition: all 0.2s;
        }
        .mini-db-btn:hover { border-color: var(--cyan); color: var(--cyan); background: var(--bg-hover); }

        .menu-toggle, .close-sidebar { display: none; background: transparent; border: none; color: var(--text-main); font-size: 20px; cursor: pointer; }
        .menu-toggle { padding: 5px; margin-right: 5px; }
        .mobile-live-dot { display: none; }

        .top-title { font-family: var(--font-code); font-size: 12px; color: var(--cyan); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; }
        
        /* Only override title color if in Failsafe mode */
        body.failsafe-active .top-title { color: var(--red) !important; }

        .theme-btn {
            background: transparent; border: 1px solid var(--border); color: var(--text-main);
            padding: 6px 14px; font-family: var(--font-code); font-size: 16px; cursor: pointer;
            transition: 0.2s; font-weight: 600; line-height: 1;
        }
        .theme-btn:hover { background: var(--bg-hover); border-color: var(--text-dim); }

        .scroll-area { flex: 1; overflow-y: auto; padding: 40px; -webkit-overflow-scrolling: touch; position: relative; }
        /* ‚îÄ‚îÄ‚îÄ ANIMATION ENGINE ‚îÄ‚îÄ‚îÄ */
        .section { 
            display: none; width: 100%;
            animation-duration: 0.4s; animation-timing-function: cubic-bezier(0.2, 0.8, 0.2, 1);
            animation-fill-mode: forwards;
        }
        .section.active { display: block; }
        
        /* Standard Entry */
        .section.fade-in { animation-name: slideUpFade; }
        /* Failsafe Entry (Slide Right) */
        .section.slide-enter-right { animation-name: slideInRight; }
        /* Dashboard Return (Slide Left) */
        .section.slide-enter-left { animation-name: slideInLeft; }
        
        @keyframes slideUpFade { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }

        /* Typography & Cards */
        h1 { font-size: 64px; color: var(--text-main); margin-bottom: 5px; text-transform: uppercase; letter-spacing: -3px; line-height: 0.9; font-weight: 800; text-shadow: 0 0 30px rgba(255,255,255,0.05); }
        h2 { font-size: 14px; color: var(--gold); font-family: var(--font-code); margin-bottom: 15px; letter-spacing: 3px; text-transform: uppercase; font-weight: 700; }
        
        .phase-header-grid {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; margin-bottom: 50px; border-bottom: 1px solid var(--border); padding-bottom: 50px;
        }
        
        .earning-badge {
            font-family: var(--font-code); font-size: 14px; color: var(--green);
            background: rgba(0, 255, 127, 0.1); padding: 12px 24px; border-radius: 4px;
            border: 1px solid var(--green); display: inline-block; font-weight: 800;
            letter-spacing: 0.5px; box-shadow: 0 0 20px rgba(0, 255, 127, 0.1); margin-top: 25px;
        }

        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px; }
        .grid-1 { display: grid; grid-template-columns: 1fr; gap: 25px; margin-bottom: 30px; }

        .card {
            background: var(--bg-card); border: 1px solid var(--border); padding: 25px;
            position: relative; height: 100%; transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        .card:hover { border-color: var(--border-active); transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .card.dense { padding: 30px 20px; }
        
        .stat-label { font-family: var(--font-code); font-size: 13px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 2px; display: block; margin-bottom: 10px; font-weight: 700; width: 100%; }
        .stat-val { font-family: var(--font-code); font-size: 48px; font-weight: 700; color: var(--text-main); letter-spacing: -3px; margin-bottom: 5px; line-height: 1; }
        .stat-val.gold { color: var(--gold); }
        .stat-val.cyan { color: var(--cyan); }
        .stat-val.green { color: var(--green); }
        .stat-sub { font-family: var(--font-code); font-size: 13px; color: var(--text-dim); font-weight: 600; letter-spacing: 0.5px;}

        .clock-split { display: flex; justify-content: space-between; align-items: center; width: 100%; gap: 10px; }
        .clock-col { display: flex; flex-direction: column; align-items: center; width: 48%; }
        .clock-big { font-family: var(--font-code); font-size: 52px; font-weight: 800; color: var(--text-main); letter-spacing: -3px; line-height: 1; }
        .clock-lbl-top { font-family: var(--font-code); font-size: 13px; color: var(--cyan); font-weight: 700; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; }

        .alert-box {
            background: linear-gradient(90deg, rgba(0,240,255,0.05) 0%, rgba(0,0,0,0) 100%); 
            border: 1px solid var(--border-active); border-left: 4px solid var(--cyan); padding: 40px 30px; 
            display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        .alert-box:hover { border-color: var(--cyan); }
        .alert-content { text-align: left; }
        .alert-content h4 { color: var(--cyan); font-family: var(--font-code); font-size: 13px; margin-bottom: 10px; letter-spacing: 2px; }
        .alert-content p { font-size: 28px; font-weight: 700; color: var(--text-main); line-height: 1.1; letter-spacing: -1px; }
        
        /* Failsafe overrides for Alert Box */
        body.failsafe-active .alert-box {
            border-left-color: var(--red);
            background: linear-gradient(90deg, rgba(255,42,109,0.05) 0%, rgba(0,0,0,0) 100%);
        }
        body.failsafe-active .alert-box:hover { border-color: var(--red); }
        body.failsafe-active .alert-content h4 { color: var(--red); }
        
        .exec-btn {
            background: var(--cyan); color: var(--text-inv); border: none; padding: 18px 36px;
            font-family: var(--font-code); font-weight: 800; font-size: 14px; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px; transition: 0.2s; 
        }
        .exec-btn:hover { background: var(--text-main); color: var(--bg-void); box-shadow: 0 0 25px var(--cyan); }
        
        /* Failsafe override for Action Button */
        body.failsafe-active .exec-btn { background: var(--red) !important; box-shadow: none !important; }
        body.failsafe-active .exec-btn:hover { background: #fff !important; color: var(--red) !important; box-shadow: 0 0 25px var(--red) !important; }

        /* FAILSAFE COMPONENTS */
        .gatekeeper-panel {
            border: 1px solid var(--red); background: rgba(255, 42, 109, 0.02); padding: 30px;
            margin-top: 20px; text-align: left; transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
            max-height: 1000px; overflow: hidden; position: relative;
        }
        .gatekeeper-panel.minimized {
            max-height: 60px; padding: 0 30px; display: flex; align-items: center; justify-content: space-between;
            background: rgba(0, 255, 127, 0.05); border-color: var(--green); cursor: pointer;
        }
        .gatekeeper-panel.minimized .gatekeeper-title { margin-bottom: 0; color: var(--green); }
        .gatekeeper-panel.minimized .gatekeeper-check { display: none; }
        .gatekeeper-panel.minimized::after {
            content: 'PROTOCOL ACTIVE // CLICK TO RESET'; font-family: var(--font-code); font-size: 11px; 
            color: var(--green); font-weight: 700; letter-spacing: 1px;
        }
        .gatekeeper-panel.minimized:hover::after { content: 'WARNING: RESETTING WIPES PROGRESS'; color: var(--red); }
        .gatekeeper-panel.minimized:hover { border-color: var(--red); }
        .gatekeeper-title {
            color: var(--red); font-family: var(--font-code); font-size: 16px; font-weight: 800;
            margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 10px;
        }
        .gatekeeper-check {
            display: flex; align-items: center; padding: 15px; border-bottom: 1px solid var(--border); cursor: pointer; transition: 0.2s;
        }
        .gatekeeper-check:hover { background: var(--bg-hover); }
        .gatekeeper-check label { cursor: pointer; font-size: 13px; color: var(--text-main); flex: 1; margin-left: 15px; }
        
        .failsafe-content {
            display: none; border-left: 4px solid var(--red); background: var(--bg-card); padding: 30px;
            margin-top: 30px; animation: slideDown 0.5s ease-out; border: 1px solid var(--border); border-left-width: 4px;
        }
        .failsafe-content.unlocked { display: block; }
        
        /* Task & Forms */
        .task-item { background: var(--bg-card); border: 1px solid var(--border); margin-bottom: 15px; transition: all 0.3s ease; text-align: left; }
        .task-item:hover { border-color: var(--border-active); background: var(--bg-hover); }
        .task-item.locked { opacity: 0.6; border-color: var(--border); filter: grayscale(100%); }
        .task-item.locked:hover { border-color: var(--red); background: rgba(255, 42, 109, 0.05); cursor: not-allowed; }
        .task-item.locked.failsafe-task:hover { border-color: var(--red); }
        
        .task-header { padding: 20px 25px; display: flex; align-items: center; gap: 20px; cursor: pointer; user-select: none; }
        
        .checkbox {
            width: 22px; height: 22px; border: 1px solid var(--text-dim); background: var(--bg-void);
            display: flex; align-items: center; justify-content: center; transition: 0.3s; flex-shrink: 0;
        }
        .task-item.completed .checkbox { background: var(--green); border-color: var(--green); color: #000; box-shadow: 0 0 15px var(--green); transform: scale(1.1); }
        .task-item.completed .checkbox::after { content: '‚úì'; font-weight: 800; font-size: 14px; }
        .task-item.completed .task-title { text-decoration: line-through; color: var(--text-dim); }
        
        /* FAILSAFE SPECIFIC TASKS */
        .task-item.failsafe-task { border-left: 1px solid var(--red); }
        .task-item.failsafe-task .checkbox { border-color: var(--red); }
        .task-item.failsafe-task.completed .checkbox { background: var(--red); box-shadow: 0 0 15px var(--red-glow); border-color: var(--red); color: #fff; }
        
        .task-title { font-size: 16px; font-weight: 500; color: var(--text-main); flex: 1; transition: color 0.3s; }
        .time-tag {
            font-family: var(--font-code); font-size: 11px; color: var(--gold); background: var(--gold-dim); 
            padding: 4px 8px; border-radius: 4px; border: 1px solid var(--gold); margin-left: 10px; font-weight: 700;
        }
        .task-details { display: none; padding: 0 25px 30px 67px; border-top: 1px solid var(--border); background: var(--bg-panel); animation: slideDown 0.3s ease-out; }
        .task-item.open .task-details { display: block; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .detail-block { margin-bottom: 20px; position: relative; padding-left: 20px; border-left: 1px solid var(--border); margin-top: 25px; }
        .detail-title { font-family: var(--font-code); color: var(--gold); font-size: 11px; font-weight: 700; margin-bottom: 5px; }
        .detail-body { font-size: 14px; color: var(--text-dim); line-height: 1.6; }
        .target-box {
            margin-top: 20px; background: var(--gold-dim); border: 1px solid var(--gold); padding: 10px 15px; 
            font-family: var(--font-code); font-size: 12px; color: var(--gold); display: flex; align-items: center; font-weight: 600;
        }
        .target-box::before { content: 'TARGET // '; opacity: 0.6; margin-right: 8px; }
        
        .action-link {
            display: flex; align-items: center; justify-content: space-between; font-family: var(--font-code); 
            font-size: 12px; color: var(--text-main); border: 1px solid var(--border); padding: 12px 20px; 
            text-decoration: none; background: var(--bg-panel); transition: all 0.2s; font-weight: 600; width: 100%;
        }
        .action-link:hover { border-color: var(--cyan); background: var(--cyan-dim); color: var(--cyan); transform: translateX(5px); }
        .ico-txt { margin-right: 12px; opacity: 1; font-size: 16px; }
        
        .pill { 
            font-family: var(--font-code); font-size: 14px; font-weight: 700; background: var(--bg-hover); 
            padding: 8px 16px; border-radius: 100px; color: var(--text-dim); margin-bottom: 20px; 
            display: inline-block; border: 1px solid var(--border); letter-spacing: 0.5px;
        }

        .prog-container { margin-bottom: 20px; padding: 20px; background: var(--bg-card); border: 1px solid var(--border); cursor: pointer; transition: all 0.2s; text-align: left; }
        .prog-container:hover { border-color: var(--text-dim); transform: translateX(5px); }
        .prog-container:active { transform: scale(0.98); border-color: var(--cyan); }
        .prog-label { display: flex; justify-content: space-between; color: var(--text-main); margin-bottom: 12px; font-family: var(--font-head); font-weight: 700; font-size: 16px; }
        .prog-track { height: 16px; background: var(--bg-hover); border-radius: 2px; border: 1px solid var(--border); overflow: hidden; }
        .prog-fill { height: 100%; transition: width 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); }

        .calc-wrapper { display: flex; gap: 30px; }
        .calc-panel { flex: 1; background: var(--bg-card); border: 1px solid var(--border); padding: 30px; transition: 0.3s; text-align: left; }
        .calc-panel.output { border-color: var(--green); background: rgba(0, 255, 127, 0.05); }
        .calc-tabs { display: flex; gap: 2px; background: var(--border); margin-bottom: 30px; }
        .c-tab { flex: 1; background: var(--bg-card); border: none; padding: 15px; color: var(--text-dim); font-family: var(--font-code); font-size: 12px; cursor: pointer; text-transform: uppercase; font-weight: 700; transition: 0.2s; }
        .c-tab:hover { color: var(--text-main); }
        .c-tab.active { background: var(--bg-void); color: var(--gold); border-top: 3px solid var(--gold); }
        .inp-label { display: block; font-family: var(--font-code); font-size: 11px; color: var(--text-dim); margin-bottom: 8px; }
        .inp-field { width: 100%; background: var(--bg-void); border: 1px solid var(--border); color: var(--text-main); padding: 12px; font-family: var(--font-code); font-size: 16px; text-align: right; transition: 0.2s; }
        .inp-field:focus { border-color: var(--cyan); box-shadow: 0 0 10px rgba(0,240,255,0.1); }

        /* RESPONSIVE */
        @media(max-width: 1100px) { 
            .grid-4, .grid-3 { grid-template-columns: repeat(2, 1fr); gap: 15px; } 
            .calc-wrapper { flex-direction: column; } 
            .sidebar { position: fixed; left: -270px; top: 0; bottom: 0; width: 260px; box-shadow: 50px 0 100px rgba(0,0,0,0.5); }
            .sidebar.active { transform: translateX(270px); }
            .menu-toggle { display: block; }
            .close-sidebar { display: block; }
            .mobile-live-dot { display: block; }
            .sidebar .live-dot { display: none; }
            .top-bar { padding: 0 20px; }
            .scroll-area { padding: 25px 20px; }
            .phase-header-grid { padding-bottom: 30px; margin-bottom: 30px; }
            h1 { font-size: 42px; word-wrap: break-word; }
            .stat-val { font-size: 36px; }
            .clock-big { font-size: 32px; }
            .earning-badge { width: 100%; text-align: center; }
            .grid-2 { gap: 15px; }
            .card { padding: 20px; }
            .top-center { display: none; } 
        }
        @media(max-width: 600px) {
            .grid-4, .grid-3, .grid-2 { grid-template-columns: 1fr; }
            .alert-box { flex-direction: column; align-items: flex-start; gap: 20px; }
            .exec-btn { width: 100%; text-align: center; }
        }
    </style>
</head>
<body>

<div class="modal-overlay" id="modal_overlay">
    <div class="modal-box" id="modal_box">
        <div class="modal-title" id="modal_title">CONFIRMATION</div>
        <div class="modal-txt" id="modal_txt">Are you sure?</div>
        <div class="modal-actions">
            <button class="modal-btn" onclick="closeModal()">CANCEL</button>
            <button class="modal-btn" id="modal_confirm_btn">CONFIRM</button>
        </div>
    </div>
</div>

<div class="sidebar-overlay" id="sidebar_overlay" onclick="toggleSidebar()"></div>
<nav class="sidebar" id="sidebar">
    <div class="brand">
        <div class="brand-inner"><div class="live-dot"></div>CAPITAL  //  <span>OS</span></div>
        <button class="close-sidebar" onclick="toggleSidebar()">‚úï</button>
    </div>
    <div class="nav-list">
        <div class="nav-label">SYSTEM</div>
        <button class="nav-btn active" onclick="go('dashboard')">00 // DASHBOARD</button>
        <button class="nav-btn" onclick="go('finance')">01 // FINANCIAL ENGINE</button>
        
        <div class="nav-label">GHOST PROTOCOL</div>
        <button class="nav-btn" onclick="go('p0')">P0 // GENESIS <span class="prog-tag" id="nav_p0">0%</span></button>
        
        <div class="nav-label">EXECUTION</div>
        <button class="nav-btn" onclick="go('p1')">P1 // PARTNER CHANNEL <span class="prog-tag" id="nav_p1">0%</span></button>
        <button class="nav-btn" onclick="go('p2')">P2 // DELIVERY OS <span class="prog-tag" id="nav_p2">0%</span></button>
        <button class="nav-btn" onclick="go('p3')">P3 // SAAS EXIT <span class="prog-tag" id="nav_p3">0%</span></button>
        
        <div class="nav-label" style="color:var(--red); margin-top:40px; border-top:1px solid var(--border); padding-top:20px;">CONTINGENCY</div>
        <button class="nav-btn failsafe-trigger" onclick="requestFailsafeToggle()" style="color:var(--red); border-left-color:transparent;">‚ö† // FAILSAFE PROTOCOL</button>
    </div>
</nav>

<div class="main" id="main_container">
    <div class="top-bar">
        <div class="top-left-group">
            <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
            <div class="live-dot mobile-live-dot"></div>
            <div class="top-title" id="current_phase_title">SYSTEM ACTIVE</div>
        </div>
        <div class="top-center">
            <button class="db-btn" onclick="go('dashboard')">
                <span>‚óâ</span> MISSION CONTROL
            </button>
        </div>

        <div class="top-right-group">
            <button class="mini-db-btn" onclick="go('dashboard')">DASHBOARD</button>
            <button class="theme-btn" onclick="toggleTheme()" title="Toggle Theme">‚òÄ / ‚óè</button>
        </div>
    </div>
    
    <div class="scroll-area">
        <div id="dashboard" class="section active fade-in">
            <div class="phase-header-grid">
                <div class="phase-info">
                    <h2>LIVE OPERATIONS</h2>
                    <h1>MISSION CONTROL</h1>
                </div>
            </div>

            <div class="grid-4">
                <div class="card dense">
                    <div class="clock-split">
                        <div class="clock-col">
                            <span class="clock-lbl-top">SFO</span>
                            <div class="clock-big" id="clock_nyc">--:--</div>
                        </div>
                        <div style="width:1px; background:var(--border); height:60px;"></div>
                        <div class="clock-col">
                            <span class="clock-lbl-top">IST</span>
                            <div class="clock-big" id="clock_ist">--:--</div>
                        </div>
                    </div>
                </div>
                
                <div class="card dense" style="border-left: 2px solid var(--gold);">
                    <span class="stat-label">MASTERY TRACKER</span>
                    <div class="stat-val gold" id="hud_hours">0 / 1000 H</div>
                    <div class="stat-sub">DEEP WORK LOGGED</div>
                </div>

                <div class="card dense" style="border-left: 2px solid var(--cyan);">
                    <span class="stat-label">80/20 FOCUS</span>
                    <div class="stat-val cyan" style="font-size:32px;" id="hud_focus_val">FOUNDATION</div>
                    <div class="stat-sub" id="hud_focus_sub">80% DATA MODEL</div>
                </div>

                <div class="card dense">
                    <span class="stat-label">SYSTEM INTEGRITY</span>
                    <div class="stat-val green" id="sys_integrity">0%</div>
                    <div class="stat-sub">TOTAL COMPLETION</div>
                </div>
            </div>
            
            <div class="alert-box">
                <div class="alert-content">
                    <h4 id="hud_obj_label">CURRENT OBJECTIVE</h4>
                    <p id="hud_obj_text">SYSTEM INITIALIZATION...</p>
                </div>
                <button class="exec-btn" id="hud_action">EXECUTE NOW</button>
            </div>

            <div class="grid-1">
                <div class="card" style="text-align:left; align-items: stretch; display:block;">
                    <span class="stat-label">PHASE PROGRESSION</span>
                    <div style="margin-top: 25px;">
                        
                        <div class="prog-container" onclick="go('p0', false)">
                            <div class="prog-label"><span>P0: GHOST PROTOCOL</span><span id="txt_p0">0%</span></div>
                            <div class="prog-track">
                                <div id="bar_p0" class="prog-fill" style="width:0%; background:var(--cyan);"></div>
                            </div>
                        </div>
                        
                        <div class="prog-container" onclick="go('p1', false)">
                            <div class="prog-label"><span>P1: PARTNER CHANNEL</span><span id="txt_p1">0%</span></div>
                            <div class="prog-track">
                                <div id="bar_p1" class="prog-fill" style="width:0%; background:var(--text-dim);"></div>
                            </div>
                        </div>

                        <div class="prog-container" onclick="go('p2', false)">
                            <div class="prog-label"><span>P2: DELIVERY OS</span><span id="txt_p2">0%</span></div>
                            <div class="prog-track">
                                <div id="bar_p2" class="prog-fill" style="width:0%; background:var(--text-dim);"></div>
                            </div>
                        </div>

                        <div class="prog-container" onclick="go('p3', false)">
                            <div class="prog-label"><span>P3: SAAS EXIT</span><span id="txt_p3">0%</span></div>
                            <div class="prog-track">
                                <div id="bar_p3" class="prog-fill" style="width:0%; background:var(--text-dim);"></div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div id="finance" class="section">
            <div class="phase-header-grid">
                <div class="phase-info">
                    <h2>UNIFIED CALCULATOR</h2>
                    <h1>FINANCIAL ENGINE</h1>
                </div>
            </div>

            <div class="calc-tabs">
                <button class="c-tab active" onclick="ftab(event, 'f1')">PHASE 1 (PARTNER)</button>
                <button class="c-tab" onclick="ftab(event, 'f2')">PHASE 2 (AGENCY)</button>
                <button class="c-tab" onclick="ftab(event, 'f3')">PHASE 3 (EXIT)</button>
            </div>

            <div id="f1" class="tab-content active">
                <div class="calc-wrapper">
                    <div class="calc-panel">
                        <span class="stat-label" style="text-align:left;">VARIABLES (30 HR TOTAL CAPACITY)</span>
                        <div class="inp-group">
                            <label class="inp-label">Partner Rate ($/hr)</label>
                            <input type="number" class="inp-field" id="in_f1_rate" value="50" oninput="c1()">
                        </div>
                        <div class="inp-group">
                            <label class="inp-label">Billable Hours / Week</label>
                            <input type="number" class="inp-field" id="in_f1_hrs" value="25" oninput="c1()">
                        </div>
                    </div>
                    <div class="calc-panel output">
                        <span class="stat-label" style="text-align:left;">PROJECTIONS</span>
                        <div class="out-group" style="margin-bottom:20px;">
                            <span class="stat-label">WEEKLY GROSS</span>
                            <div class="stat-val green" id="out_f1_wk">$1,250</div>
                        </div>
                        <div class="out-group" style="margin-bottom:20px;">
                            <span class="stat-label">MONTHLY GROSS</span>
                            <div class="stat-val green" id="out_f1_mo">$5,000</div>
                        </div>
                        <div class="out-group" style="margin-bottom:20px;">
                            <span class="stat-label">ANNUAL GROSS</span>
                            <div class="stat-val gold" id="out_f1_yr">$60,000</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="f2" class="tab-content hidden" style="display:none;">
                <div class="calc-wrapper">
                    <div class="calc-panel">
                        <span class="stat-label" style="text-align:left;">REVENUE SOURCES (TARGET: $1M ARR)</span>
                        <div class="grid-2" style="margin-bottom:10px; gap:10px;">
                            <div class="inp-group">
                                <label class="inp-label">Retainer ($)</label>
                                <input type="number" class="inp-field" id="in_f2_ret" value="5000" oninput="c2()">
                            </div>
                            <div class="inp-group">
                                <label class="inp-label">Clients (#)</label>
                                <input type="number" class="inp-field" id="in_f2_cli" value="12" oninput="c2()">
                            </div>
                        </div>
                        <div class="grid-2" style="margin-bottom:20px; gap:10px;">
                            <div class="inp-group">
                                <label class="inp-label">Project Fee ($)</label>
                                <input type="number" class="inp-field" id="in_f2_proj" value="20000" oninput="c2()">
                            </div>
                            <div class="inp-group">
                                <label class="inp-label">Proj/Mo (#)</label>
                                <input type="number" class="inp-field" id="in_f2_pcount" value="1" oninput="c2()">
                            </div>
                        </div>
                        
                        <span class="stat-label" style="margin-bottom:10px; border-top:1px solid var(--border); padding-top:20px; text-align:left;">COSTS & ADS (REALITY CHECK)</span>
                         <div class="grid-3" style="margin-bottom:10px; gap:10px;">
                            <div class="inp-group">
                                <label class="inp-label">Staff Count</label>
                                <input type="number" class="inp-field" id="in_f2_staff" value="3" oninput="c2()">
                            </div>
                            <div class="inp-group">
                                <label class="inp-label">Avg Salary ($)</label>
                                <input type="number" class="inp-field" id="in_f2_sal" value="1500" oninput="c2()">
                            </div>
                            <div class="inp-group">
                                <label class="inp-label" style="color:var(--cyan);">Ad Budget ($)</label>
                                <input type="number" class="inp-field" style="border-color:var(--cyan);" id="in_f2_ads" value="500" oninput="c2()">
                            </div>
                        </div>
                    </div>
                    
                    <div class="calc-panel output">
                        <span class="stat-label" style="text-align:left;">AGENCY SCALE</span>
                        <div class="out-group" style="margin-bottom:20px;">
                            <span class="stat-label">MONTHLY REVENUE</span>
                            <div class="stat-val green" id="out_f2_rev">$80,000</div>
                        </div>
                        <div class="out-group" style="margin-bottom:20px;">
                            <span class="stat-label">OPEX (STAFF + ADS)</span>
                            <div class="stat-val" style="color:var(--red);" id="out_f2_cost">-$5,000</div>
                        </div>
                        <div class="out-group" style="margin-bottom:20px; border-top:1px dashed var(--green); padding-top:10px;">
                            <span class="stat-label">NET PROFIT (MO)</span>
                            <div class="stat-val green" id="out_f2_net">$75,000</div>
                        </div>
                        <div class="out-group">
                            <span class="stat-label">ANNUAL RECURRING REVENUE (ARR)</span>
                            <div class="stat-val gold" id="out_f2_run">$960,000</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="f3" class="tab-content hidden" style="display:none;">
                <div class="calc-wrapper">
                    <div class="calc-panel">
                        <span class="stat-label" style="text-align:left;">VARIABLES</span>
                        <div class="inp-group">
                            <label class="inp-label">App License ($ / Year)</label>
                            <input type="number" class="inp-field" id="in_f3_lic" value="3000" oninput="c3()">
                        </div>
                        <div class="inp-group">
                            <label class="inp-label">Total Users</label>
                            <input type="number" class="inp-field" id="in_f3_users" value="350" oninput="c3()">
                        </div>
                        <div class="inp-group">
                            <label class="inp-label">Exit Multiple (x Revenue)</label>
                            <input type="number" class="inp-field" id="in_f3_mult" value="5" oninput="c3()">
                        </div>
                    </div>
                    <div class="calc-panel output">
                        <span class="stat-label" style="text-align:left;">PROJECTIONS</span>
                        <div class="out-group" style="margin-bottom:20px;">
                            <span class="stat-label">ANNUAL REVENUE (ARR)</span>
                            <div class="stat-val green" id="out_f3_arr">$1.05M</div>
                        </div>
                        <div class="out-group" style="margin-bottom:20px;">
                            <span class="stat-label">EXIT VALUATION</span>
                            <div class="stat-val green" id="out_f3_exit">$5.25M</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="p0" class="section" data-phase="0">
            <div class="phase-header-grid">
                <span class="pill">PHASE 0 (MONTH 1-3)</span>
                <h1>GHOST PROTOCOL</h1>
                <span class="earning-badge">POTENTIAL: $0</span>
            </div>
            
            <div class="grid-2">
                <div class="card dense" style="border-left: 2px solid var(--gold);">
                    <span class="stat-label">80/20 OPERATIONAL FOCUS</span>
                    <h3 style="color:var(--gold); margin-bottom:5px;">TECHNICAL & DOMAIN</h3>
                    <p style="font-size:13px; color:var(--text-dim);">You must master <strong>Salesforce FSC</strong> AND <strong>Wealth Management</strong> concepts. You are building a "Specialist" identity, not a "General Admin".</p>
                </div>
                <div class="card dense">
                    <span class="stat-label">HIGH-LEVERAGE ABSORB [15 H]</span>
                    <div style="display:flex; flex-direction: column; gap:8px; margin-top:10px;">
                        <a href="https://jamesclear.com/atomic-habits" target="_blank" class="action-link"><div><span class="ico-txt">üìñ</span> ATOMIC HABITS (5H)</div> <span>‚ñ∫</span></a>
                        <a href="https://www.cfp.net/get-certified/certification-process" target="_blank" class="action-link"><div><span class="ico-txt">üéì</span> CFP PROCESS (10H)</div> <span>‚ñ∫</span></a>
                    </div>
                </div>
            </div>

            <div style="margin: 40px 0 20px 0; border-bottom: 1px solid var(--border); padding-bottom: 10px;">
                <span class="stat-label" style="color:var(--cyan); font-size:12px;">>>> DEPLOYED INTEL (THE SPECIALIST STACK)</span>
            </div>
            
            <div class="grid-3">
                <div class="card dense" style="align-items: flex-start; text-align: left;">
                    <span class="stat-label">BASELINE [150 H]</span>
                    <h3 style="font-size:16px; color:var(--text-main); margin-bottom:10px;">ADMIN CERT</h3>
                    <div style="font-size:11px; color:var(--text-dim); margin-bottom:15px; line-height:1.4;">
                        1. Trailhead: Admin Beginner.<br>
                        2. FocusOnForce: 90% Avg Score.<br>
                        3. Exam: ADM-201.
                    </div>
                    <a href="https://trailhead.salesforce.com/en/credentials/administrator" target="_blank" class="action-link"><div>START TRAILHEAD</div> <span>‚Üó</span></a>
                </div>
                <div class="card dense" style="align-items: flex-start; text-align: left;">
                    <span class="stat-label">DOMAIN [30 H]</span>
                    <h3 style="font-size:16px; color:var(--text-main); margin-bottom:10px;">WEALTH FLUENCY</h3>
                    <div style="font-size:11px; color:var(--text-dim); margin-bottom:15px; line-height:1.4;">
                        1. Learn RIA Compliance (SEC).<br>
                        2. Understand AUM & Fee Structures.<br>
                        3. Study 'Custodians' (Schwab/Fidelity).
                    </div>
                    <a href="https://www.nasaa.org/industry-resources/investment-advisers/investment-adviser-guide/" target="_blank" class="action-link"><div>READ NASAA GUIDE</div> <span>‚Üó</span></a>
                </div>
                <div class="card dense" style="align-items: flex-start; text-align: left;">
                    <span class="stat-label">SPECIALTY [40 H]</span>
                    <h3 style="font-size:16px; color:var(--text-main); margin-bottom:10px;">FSC MODEL</h3>
                    <div style="font-size:11px; color:var(--text-dim); margin-bottom:15px; line-height:1.4;">
                        1. Household Data Model.<br>
                        2. Financial Accounts Rollups.<br>
                        3. Action Plans & Life Events.
                    </div>
                    <a href="https://help.salesforce.com/s/articleView?id=sf.fsc_admin_guide.htm&type=5" target="_blank" class="action-link"><div>READ FSC DOCS</div> <span>‚Üó</span></a>
                </div>
            </div>

            <br>

            <div class="task-item" id="t0_1">
                <div class="task-header" onclick="toggleAccordion(event, 't0_1')">
                    <div class="check-target" onclick="toggleCheck(event, 't0_1')"><div class="checkbox"></div></div>
                    <div class="task-title">1. Hardware & Environment (Day 1)</div>
                    <span class="time-tag">[5 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: ENCRYPTED WORKSTATION READY</div>
                    <div class="detail-block">
                        <div class="detail-title">ACTION STEPS</div>
                        <div class="detail-body">
                            1. <strong>Machine:</strong> Dell Latitude/ThinkPad (i5/16GB) or equiv.<br>
                            2. <strong>Security (MANDATORY):</strong> Enable BitLocker. Wealth data requires encryption at rest.<br>
                            3. <strong>Isolation:</strong> Create a dedicated Chrome Profile "Capital OS".<br>
                            4. <strong>Password Manager:</strong> 1Password or Bitwarden.
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-item" id="t0_2">
                <div class="task-header" onclick="toggleAccordion(event, 't0_2')">
                    <div class="check-target" onclick="toggleCheck(event, 't0_2')"><div class="checkbox"></div></div>
                    <div class="task-title">2. Admin Certification (Weeks 1-8)</div>
                    <span class="time-tag">[150 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: PASS ADM-201 EXAM</div>
                    <div class="detail-block">
                        <div class="detail-title">ROUTINE (3 HRS/DAY)</div>
                        <div class="detail-body">
                            <strong>The Drill:</strong><br>
                            1. 2 Hours: Trailhead (Active learning).<br>
                            2. 1 Hour: FocusOnForce Practice Exams.<br>
                            <i>Constraint: Do not book the exam until you score 85%+ on 3 consecutive mocks.</i>
                        </div>
                    </div>
                    <a href="https://webassessor.com/salesforce" target="_blank" class="action-link"><div>BOOK EXAM</div> <span>‚Üó</span></a>
                </div>
            </div>
            
            <div class="task-item" id="t0_3">
                <div class="task-header" onclick="toggleAccordion(event, 't0_3')">
                    <div class="check-target" onclick="toggleCheck(event, 't0_3')"><div class="checkbox"></div></div>
                    <div class="task-title">3. Practical WorkEx: Superbadges</div>
                    <span class="time-tag">[40 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: 2 SUPERBADGES COMPLETED</div>
                    <div class="detail-block">
                        <div class="detail-title">THE SIMULATION</div>
                        <div class="detail-body">
                            Complete these to prove you can build logic. Use the <strong>Admin Super Set</strong>.<br>
                            1. <strong>Security Specialist:</strong> Essential for Finance.<br>
                            2. <strong>Business Admin Specialist:</strong> Process automation proof.
                        </div>
                    </div>
                    <a href="https://trailhead.salesforce.com/content/learn/superbadges/superbadge_admin_superset" target="_blank" class="action-link"><div>OPEN SUPER SET</div> <span>‚Üó</span></a>
                </div>
            </div>

            <div class="task-item" id="t0_4">
                <div class="task-header" onclick="toggleAccordion(event, 't0_4')">
                    <div class="check-target" onclick="toggleCheck(event, 't0_4')"><div class="checkbox"></div></div>
                    <div class="task-title">4. Domain Fluency (Wealth 101)</div>
                    <span class="time-tag">[30 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: PASS "VOCABULARY" CHECK</div>
                    <div class="detail-block">
                        <div class="detail-title">VOCABULARY IS TRUST</div>
                        <div class="detail-body">
                            You cannot sell to partners if you don't know their clients' business.<br>
                            1. <strong>CFP Module:</strong> Study "Investment Planning" from CFP prep materials. (Do not take the exam, just learn).<br>
                            2. <strong>Define:</strong> AUM Fees vs Retainer Fees.<br>
                            3. <strong>Define:</strong> "Household" vs "Client" data models in FSC.
                        </div>
                    </div>
                </div>
            </div>

             <div class="task-item" id="t0_5">
                <div class="task-header" onclick="toggleAccordion(event, 't0_5')">
                    <div class="check-target" onclick="toggleCheck(event, 't0_5')"><div class="checkbox"></div></div>
                    <div class="task-title">5. Build "WealthWise" Demo Org</div>
                    <span class="time-tag">[40 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: FUNCTIONAL DEMO ENV</div>
                    <div class="detail-block">
                        <div class="detail-title">YOUR PRODUCT</div>
                        <div class="detail-body">
                            Build a Dev Org that mimics a real Wealth Firm.<br>
                            1. Create 5 Households with $5M+ AUM.<br>
                            2. Build a Flow: "When Client turns 72, auto-create task for RMD (Required Minimum Distribution)."<br>
                            <i>This specific flow proves you understand the industry.</i>
                        </div>
                    </div>
                    <a href="https://developer.salesforce.com/signup" target="_blank" class="action-link"><div>GET DEV ORG</div> <span>‚Üó</span></a>
                </div>
            </div>

            <div class="task-item" id="t0_6">
                <div class="task-header" onclick="toggleAccordion(event, 't0_6')">
                    <div class="check-target" onclick="toggleCheck(event, 't0_6')"><div class="checkbox"></div></div>
                    <div class="task-title">6. Systems & Mindset (Absorb)</div>
                    <span class="time-tag">[15 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: OPERATING SYSTEM INSTALLED</div>
                    <div class="detail-block">
                        <div class="detail-title">REQUIRED READING</div>
                        <div class="detail-body">
                            1. <strong>Atomic Habits:</strong> Implement "Habit Stacking" for your 30hr/week schedule.<br>
                            2. <strong>RIA vs Broker:</strong> Read the Investopedia Article 3 times. You must explain the "Fiduciary Standard" to a 5-year-old.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="p1" class="section" data-phase="1">
            <div class="phase-header-grid">
                <span class="pill">PHASE 1 (MONTH 4-6)</span>
                <h1>PARTNER CHANNEL</h1>
                <span class="earning-badge">GOAL: 2 RETAINER PARTNERS</span>
            </div>
            
            <div class="grid-2">
                <div class="card dense" style="border-left: 2px solid var(--gold);">
                    <span class="stat-label">STRATEGY SHIFT</span>
                    <h3 style="color:var(--gold); margin-bottom:5px;">THE SUBCONTRACTOR</h3>
                    <p style="font-size:13px; color:var(--text-dim);"><strong>Do not sell to end clients yet.</strong> Sell to Salesforce Consultancies (Partners) who have overflow work. They have the trust; you have the labor.</p>
                </div>
                <div class="card dense">
                    <span class="stat-label">HIGH-LEVERAGE ABSORB [10 H]</span>
                    <div style="display:flex; flex-direction: column; gap:8px; margin-top:10px;">
                        <a href="https://www.kitces.com/blog/" target="_blank" class="action-link"><div><span class="ico-txt">üìà</span> KITCES.COM (SALES INTEL)</div> <span>‚ñ∫</span></a>
                        <a href="https://appexchange.salesforce.com/consulting" target="_blank" class="action-link"><div><span class="ico-txt">üîç</span> APPEXCHANGE FINDER</div> <span>‚ñ∫</span></a>
                    </div>
                </div>
            </div>

            <div style="margin: 40px 0 20px 0; border-bottom: 1px solid var(--border); padding-bottom: 10px;">
                <span class="stat-label" style="color:var(--cyan); font-size:12px;">>>> DEPLOYED INTEL (CHANNEL SALES)</span>
            </div>

            <div class="card" style="border-left: 4px solid var(--cyan); margin-bottom: 30px; align-items: flex-start; text-align: left;">
                <span class="stat-label" style="color:var(--cyan); margin-bottom:5px;">THE "WHITE LABEL" OFFER</span>
                <p style="font-size:16px; color:var(--text-main); font-weight:700; margin-bottom:15px;">Your Pitch: "I am a silent FSC Specialist who executes your backlog."</p>
                <div style="font-size:13px; color:var(--text-dim); line-height:1.6;">
                    ‚Ä¢ <strong>Rate:</strong> $50/hr (Lower than US, higher than Upwork).<br>
                    ‚Ä¢ <strong>Speed:</strong> "I work IST (4 PM - 12 AM), so your work is done when you wake up."<br>
                    ‚Ä¢ <strong>Compliance:</strong> "I have E&O Insurance and a registered entity."
                </div>
            </div>

            <div class="task-item locked" id="t1_1" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't1_1')">
                    <div class="check-target" onclick="toggleCheck(event, 't1_1')"><div class="checkbox"></div></div>
                    <div class="task-title">1. Content Ledger & Case Studies</div>
                    <span class="time-tag">[40 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: 3 ARTICLES + 1 TEMPLATE</div>
                    <div class="detail-block">
                        <div class="detail-title">PROOF OF WORK</div>
                        <div class="detail-body">
                            1. <strong>Write 3 Tech Articles (1500w):</strong> Topic example: "Automating RMD Tasks in Salesforce FSC using Flows". Publish on LinkedIn/Medium.<br>
                            2. <strong>Create Win Template:</strong> Build a 1-page PDF template to document "Problem > Solution > Outcome" for every ticket you solve. This builds your portfolio from Day 1.
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-item locked" id="t1_2" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't1_2')">
                    <div class="check-target" onclick="toggleCheck(event, 't1_2')"><div class="checkbox"></div></div>
                    <div class="task-title">2. Partner Mapping</div>
                    <span class="time-tag">[20 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: 50 PARTNERS IN SHEET</div>
                    <div class="detail-block">
                        <div class="detail-title">THE HUNTING GROUNDS</div>
                        <div class="detail-body">
                            Use the <strong>AppExchange Consultant Finder</strong>.<br>
                            1. Filter: "Financial Services".<br>
                            2. Size: Look for boutiques (10-50 employees). Avoid the Big 4 (Deloitte/Accenture) - they won't hire contractors.<br>
                            3. Identify the "Practice Lead" or "Delivery Director" on LinkedIn.
                        </div>
                    </div>
                    <a href="https://appexchange.salesforce.com/consulting" target="_blank" class="action-link"><div>START MAPPING</div> <span>‚Üó</span></a>
                </div>
            </div>

            <div class="task-item locked" id="t1_3" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't1_3')">
                    <div class="check-target" onclick="toggleCheck(event, 't1_3')"><div class="checkbox"></div></div>
                    <div class="task-title">3. Channel Outreach (First 10)</div>
                    <span class="time-tag">[Ongoing]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: 5 PARTNERS / DAY</div>
                    <div class="detail-block">
                        <div class="detail-title">THE ACQUISITION STRATEGY</div>
                        <div class="detail-body">
                            <strong>Goal:</strong> Get your first 5 Partners (who bring the clients).<br>
                            <strong>Script:</strong> "Hi [Name], I noticed [Firm] is growing its Wealth practice. I'm an FSC-specialized Admin. I just wrote a technical guide on RMD Automation [Link] that might help your juniors. If you need white-label overflow capacity, I have 25hrs/week open."
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-item locked" id="t1_4" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't1_4')">
                    <div class="check-target" onclick="toggleCheck(event, 't1_4')"><div class="checkbox"></div></div>
                    <div class="task-title">4. Professional Infrastructure</div>
                    <span class="time-tag">[10 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: LEGAL & TAX SETUP COMPLETE</div>
                    <div class="detail-block">
                        <div class="detail-title">ELIMINATE FRICTION</div>
                        <div class="detail-body">
                            Partners need to know you are safe.<br>
                            1. <strong>LLC/Proprietorship:</strong> Register locally (e.g., Udyam Reg in India).<br>
                            2. <strong>Insurance:</strong> Get Professional Indemnity (E&O). Even a small policy ($1M coverage) separates you from "random freelancer".<br>
                            3. <strong>W-8BEN:</strong> Have this tax form filled out for US partners (Tax Exemption).
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-item locked" id="t1_5" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't1_5')">
                    <div class="check-target" onclick="toggleCheck(event, 't1_5')"><div class="checkbox"></div></div>
                    <div class="task-title">5. First "Associate" Contract</div>
                    <span class="time-tag">[Milestone]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: SIGNED MSA</div>
                    <div class="detail-block">
                        <div class="detail-title">EXECUTION</div>
                        <div class="detail-body">
                            Your goal is a <strong>Retainer</strong>, not hourly.<br>
                            "I will handle all Ticket Level 1 & 2 config for your Wealth clients for $4,000/month."<br>
                            This gives them predictability, and you stability.
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-item locked" id="t1_6" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't1_6')">
                    <div class="check-target" onclick="toggleCheck(event, 't1_6')"><div class="checkbox"></div></div>
                    <div class="task-title">6. Global Payment Rails</div>
                    <span class="time-tag">[2 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: WISE ACCOUNT + FIRC</div>
                    <div class="detail-block">
                        <div class="detail-title">GETTING PAID (INDIA CONTEXT)</div>
                        <div class="detail-body">
                            1. <strong>Open Wise Business:</strong> Get a US Account Number (ACH).<br>
                            2. <strong>FIRC (Critical):</strong> Ensure you download the FIRC (Foreign Inward Remittance Certificate) for every payment to file for 0% GST (LUT) since this is Service Export.
                        </div>
                    </div>
                    <a href="https://wise.com/us/business/" target="_blank" class="action-link"><div>OPEN WISE BUSINESS</div> <span>‚Üó</span></a>
                </div>
            </div>

            <div class="task-item locked" id="t1_7" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't1_7')">
                    <div class="check-target" onclick="toggleCheck(event, 't1_7')"><div class="checkbox"></div></div>
                    <div class="task-title">7. Sales Engineering (Absorb)</div>
                    <span class="time-tag">[10 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: RESEARCH COMPLETE</div>
                    <div class="detail-block">
                        <div class="detail-title">REQUIRED STUDY</div>
                        <div class="detail-body">
                            1. <strong>Michael Kitces Blog:</strong> Read top 5 articles on RIA technology stacks.<br>
                            2. <strong>Consulting Finder:</strong> Spend 5 hours strictly filtering and analyzing competitor offerings on AppExchange.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="p2" class="section" data-phase="2">
            <div class="phase-header-grid">
                <span class="pill">PHASE 2 (YEAR 2-4)</span>
                <h1>AGENCY: DELIVERY OS</h1>
                <span class="earning-badge">POTENTIAL: $83K / MO</span>
            </div>
            
            <div class="grid-2">
                <div class="card dense" style="border-left: 2px solid var(--gold);">
                    <span class="stat-label">80/20 OPERATIONAL FOCUS</span>
                    <h3 style="color:var(--gold); margin-bottom:5px;">SYSTEMIZATION</h3>
                    <p style="font-size:13px; color:var(--text-dim);">You cannot scale chaos. If you do a task twice, you must write a <strong>Script/SOP</strong>. You are building a factory, not a job.</p>
                </div>
                 <div class="card dense">
                    <span class="stat-label">HIGH-LEVERAGE ABSORB [10 H]</span>
                    <div style="display:flex; flex-direction: column; gap:8px; margin-top:10px;">
                        <a href="https://handbook.gitlab.com/" target="_blank" class="action-link"><div><span class="ico-txt">üìñ</span> MODEL: GITLAB HANDBOOK (5H)</div> <span>‚ñ∫</span></a>
                        <a href="https://www.notion.so/help/guides/category/documentation" target="_blank" class="action-link"><div><span class="ico-txt">üõ†Ô∏è</span> TOOL: NOTION WIKI (5H)</div> <span>‚ñ∫</span></a>
                    </div>
                </div>
            </div>

            <br>

            <div class="task-item locked" id="t2_1" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't2_1')">
                    <div class="check-target" onclick="toggleCheck(event, 't2_1')"><div class="checkbox"></div></div>
                    <div class="task-title">1. The SOP Library</div>
                    <span class="time-tag">[20 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: 5 CORE PROCEDURES WRITTEN</div>
                    <div class="detail-block">
                        <div class="detail-title">DOCUMENT EVERYTHING</div>
                        <div class="detail-body">
                            Create a Notion workspace. Write these 5 exact docs to ensure quality control:<br>
                            1. <strong>"New User Setup":</strong> Exact license types and Permission Set Groups (e.g., 'Wealth_Advisor_psg').<br>
                            2. <strong>"Sandbox Refresh":</strong> Data masking steps to protect Wealth data.<br>
                            3. <strong>"Flow Naming Convention":</strong> Standardized API naming (e.g., 'Flow_RMD_Auto_v1').<br>
                            4. <strong>"Deployment Protocol":</strong> Steps to move from Dev -> UAT -> Prod using Change Sets.<br>
                            5. <strong>"Emergency Rollback":</strong> What to do if a deployment breaks Production.
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-item locked" id="t2_2" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't2_2')">
                    <div class="check-target" onclick="toggleCheck(event, 't2_2')"><div class="checkbox"></div></div>
                    <div class="task-title">2. Asynchronous Delivery</div>
                    <span class="time-tag">[10 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: 100% CLIENT RETENTION</div>
                    <div class="detail-block">
                        <div class="detail-title">CLIENT RETENTION PROTOCOL</div>
                        <div class="detail-body">
                            Churn happens when clients feel ignored. Setup Loom and draft your update template.<br>
                            <strong>The Fix:</strong> Friday Video Updates.<br>
                            Send a 2-minute Loom video every Friday to the Partner Lead summarizing:<br>
                            1. <strong>Accomplished:</strong> Tickets closed.<br>
                            2. <strong>Blockers:</strong> Inputs needed from them.<br>
                            3. <strong>Next Week:</strong> The plan.
                        </div>
                    </div>
                </div>
            </div>

             <div class="task-item locked" id="t2_3" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't2_3')">
                    <div class="check-target" onclick="toggleCheck(event, 't2_3')"><div class="checkbox"></div></div>
                    <div class="task-title">3. The Junior Clone (Hiring SOP)</div>
                    <span class="time-tag">[10 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: 10 HOURS DELEGATED/WEEK</div>
                    <div class="detail-block">
                        <div class="detail-title">SCREENING FILTER</div>
                        <div class="detail-body">
                            <strong>The Test:</strong> "I need you to build a Flow that updates the 'AUM Tier' field based on the 'Total Household Value' Rollup. Send me a Loom of it working in your Dev Org."<br>
                            <strong>Pass Criteria:</strong> They must handle <strong>NULL values</strong> in the formula (e.g., if a client has $0 balance). If they miss this, do not hire.
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-item locked" id="t2_4" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't2_4')">
                    <div class="check-target" onclick="toggleCheck(event, 't2_4')"><div class="checkbox"></div></div>
                    <div class="task-title">4. Systems Engineering (Absorb)</div>
                    <span class="time-tag">[10 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: NOTION TEMPLATE BUILT</div>
                    <div class="detail-block">
                        <div class="detail-title">REQUIRED STUDY</div>
                        <div class="detail-body">
                            1. <strong>GitLab Handbook:</strong> Read the "Communication" and "Asynchronous Work" sections to understand how to run a remote company.<br>
                            2. <strong>Notion Architecture:</strong> Build a "Company Home" dashboard that links to your SOP database.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="p3" class="section" data-phase="3">
            <div class="phase-header-grid">
                <span class="pill">PHASE 3 (YEAR 5+)</span>
                <h1>SAAS: THE EXIT</h1>
                <span class="earning-badge">POTENTIAL: $10M EXIT</span>
            </div>
            
            <div class="grid-2">
                <div class="card dense" style="border-left: 2px solid var(--gold);">
                    <span class="stat-label">80/20 OPERATIONAL FOCUS</span>
                    <h3 style="color:var(--gold); margin-bottom:5px;">PRODUCT</h3>
                    <p style="font-size:13px; color:var(--text-dim);">Spend 80% time defining the <strong>Product Roadmap</strong> based on client pain points found in Phase 2.</p>
                </div>
                <div class="card dense">
                    <span class="stat-label">HIGH-LEVERAGE ABSORB [20 H]</span>
                    <div style="display:flex; flex-direction: column; gap:8px; margin-top:10px;">
                        <a href="https://www.momtestbook.com/" target="_blank" class="action-link"><div><span class="ico-txt">üìñ</span> READ: THE MOM TEST (5H)</div> <span>‚ñ∫</span></a>
                        <a href="https://www.ycombinator.com/library" target="_blank" class="action-link"><div><span class="ico-txt">üéì</span> YC STARTUP SCHOOL (15H)</div> <span>‚ñ∫</span></a>
                    </div>
                </div>
            </div>

            <br>

            <div class="task-item locked" id="t3_1" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't3_1')">
                    <div class="check-target" onclick="toggleCheck(event, 't3_1')"><div class="checkbox"></div></div>
                    <div class="task-title">1. Market Validation</div>
                    <span class="time-tag">[20 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: 10 SIGNED LOIs</div>
                    <div class="detail-block">
                        <div class="detail-title">STRATEGY</div>
                        <div class="detail-body">
                            Do not write code yet.<br>
                            1. Identify the "Gap" plugin you manually built 50 times in Phase 2.<br>
                            2. Call your 10 best Partner contacts.<br>
                            3. Ask: "If I built this as a plugin for $3k/year, would you buy it?"<br>
                            4. Get a non-binding <strong>Letter of Intent (LOI)</strong>.
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-item locked" id="t3_2" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't3_2')">
                    <div class="check-target" onclick="toggleCheck(event, 't3_2')"><div class="checkbox"></div></div>
                    <div class="task-title">2. MVP Scoping & Stack</div>
                    <span class="time-tag">[500 H+]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: TECHNICAL SPEC DOC</div>
                    <div class="detail-block">
                        <div class="detail-title">TECH STACK</div>
                        <div class="detail-body">
                            To survive the Security Review, you must use standard Salesforce tech:<br>
                            1. <strong>LWC (Lightning Web Components)</strong> for UI.<br>
                            2. <strong>Apex</strong> for backend logic (Must be bulkified).<br>
                            3. <strong>Managed Package</strong> (2GP) for distribution.
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-item locked" id="t3_3" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't3_3')">
                    <div class="check-target" onclick="toggleCheck(event, 't3_3')"><div class="checkbox"></div></div>
                    <div class="task-title">3. Security & Compliance</div>
                    <span class="time-tag">[100 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: PASS SECURITY REVIEW</div>
                    <div class="detail-block">
                        <div class="detail-title">THE SECURITY TAX</div>
                        <div class="detail-body">
                            To list on AppExchange, you must pass the <strong>Salesforce Security Review</strong>.<br>
                            1. Budget <strong>$2,550</strong> for the listing fee.<br>
                            2. Run <strong>Checkmarx</strong> scans on your code weekly to find vulnerabilities.<br>
                            3. Use <strong>PMD Source Code Analyzer</strong> to fix code quality issues.
                        </div>
                    </div>
                    <a href="https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/security_review_overview.htm" target="_blank" class="action-link"><div>VIEW SEC GUIDELINES</div> <span>‚Üó</span></a>
                </div>
            </div>

            <div class="task-item locked" id="t3_4" title="Complete Previous Phase to Unlock">
                <div class="task-header" onclick="toggleAccordion(event, 't3_4')">
                    <div class="check-target" onclick="toggleCheck(event, 't3_4')"><div class="checkbox"></div></div>
                    <div class="task-title">4. Founder Mindset (Absorb)</div>
                    <span class="time-tag">[20 H]</span>
                </div>
                <div class="task-details">
                    <div class="target-box">TARGET: PRODUCT ROADMAP DRAFTED</div>
                    <div class="detail-block">
                        <div class="detail-title">REQUIRED STUDY</div>
                        <div class="detail-body">
                            1. <strong>The Mom Test:</strong> Read it. Write a script for your 10 validation calls.<br>
                            2. <strong>YC Startup School:</strong> Watch the "How to Talk to Users" module.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="failsafe" class="section">
            <div class="phase-header-grid" style="border-bottom-color:var(--red);">
                <span class="pill" style="border-color:var(--red); color:var(--red); background:rgba(255,42,109,0.05);">EMERGENCY PROTOCOL</span>
                <h1 style="color:var(--red);">PROTOCOL: PIVOT</h1>
                <span class="earning-badge" style="border-color:var(--red); background:rgba(255,42,109,0.05); color:var(--red);">TARGET: $100K/YR REMOTE</span>
            </div>

            <div class="alert-box" style="border-left-color:var(--red); background: linear-gradient(90deg, rgba(255,42,109,0.05) 0%, rgba(0,0,0,0) 100%);">
                <div class="alert-content">
                    <h4 style="color:var(--red);">GATEKEEPER SYSTEM</h4>
                    <p style="color:var(--text-main); font-size:16px; font-weight:400;">The Failsafe is NOT an easy exit. It is a calculated pivot only when the Primary Mission is proven impossible. You must verify failure to unlock the Career Guide.</p>
                </div>
            </div>

            <div class="gatekeeper-panel" id="failsafe_gatekeeper">
                <div class="gatekeeper-title"><span>üîí</span> VERIFY FAILURE CRITERIA</div>
                <div class="gatekeeper-check"><input type="checkbox" onchange="checkGatekeeper()"><label>I have contacted 50+ Partners (Phase 1) with no retainer secured.</label></div>
                <div class="gatekeeper-check"><input type="checkbox" onchange="checkGatekeeper()"><label>I have published 3 Technical Articles/Case Studies.</label></div>
                <div class="gatekeeper-check"><input type="checkbox" onchange="checkGatekeeper()"><label>I have built the "WealthWise" Demo Org (Phase 0) fully.</label></div>
                <div class="gatekeeper-check"><input type="checkbox" onchange="checkGatekeeper()"><label>I have &lt; 3 Retainer Clients after 12 months of execution.</label></div>
                <div class="gatekeeper-check"><input type="checkbox" onchange="checkGatekeeper()"><label>REALITY CHECK: I accept wiping my "Founder" identity to secure a high-paying Role.</label></div>
            </div>

            <div class="failsafe-content" id="failsafe_content">
                <h2 style="color:var(--red); border-bottom:1px solid var(--border); padding-bottom:15px; margin-bottom:25px;">CAREER CAPITAL DEPLOYMENT</h2>
                
                <div class="task-item failsafe-task" id="tf_1">
                    <div class="task-header" onclick="toggleAccordion(event, 'tf_1')">
                        <div class="check-target" onclick="toggleCheck(event, 'tf_1')"><div class="checkbox"></div></div>
                        <div class="task-title">1. The "Fractional Architect" Reframe</div>
                        <span class="time-tag" style="color:var(--red); border-color:var(--red);">[5 H]</span>
                    </div>
                    <div class="task-details">
                        <div class="target-box" style="border-color:var(--red); color:var(--red); background:rgba(255,42,109,0.05);">TARGET: RESUME V2.0 (NO "FOUNDER" TITLE)</div>
                        <div class="detail-block">
                            <div class="detail-title">THE PSYCHOLOGY</div>
                            <div class="detail-body">
                                US Recruiters fear "Founders" (flight risk). They love "Consultants" (experts).<br>
                                1. <strong>Title Change:</strong> Change "Founder/CEO" to "Lead Salesforce Architect (Contract)".<br>
                                2. <strong>Project Mapping:</strong> Convert your Agency Client Projects into "Key Engagements".<br>
                                3. <strong>Bullet Points:</strong> "Designed FSC Household Model for $50M RIA" (Not "Sold a client").
                            </div>
                        </div>
                    </div>
                </div>

                <div class="task-item failsafe-task locked" id="tf_2">
                    <div class="task-header" onclick="toggleAccordion(event, 'tf_2')">
                        <div class="check-target" onclick="toggleCheck(event, 'tf_2')"><div class="checkbox"></div></div>
                        <div class="task-title">2. The "Shadow Profile" (LinkedIn SEO)</div>
                        <span class="time-tag" style="color:var(--red); border-color:var(--red);">[3 H]</span>
                    </div>
                    <div class="task-details">
                        <div class="target-box" style="border-color:var(--red); color:var(--red); background:rgba(255,42,109,0.05);">TARGET: APPEAR IN US RECRUITER SEARCHES</div>
                        <div class="detail-block">
                            <div class="detail-title">KEYWORD RIGGING</div>
                            <div class="detail-body">
                                Recruiters search via Boolean strings. You must exist in them.<br>
                                1. <strong>Headline:</strong> "Salesforce FSC Architect | Wealth Management & Insurance | OmniStudio | Flows".<br>
                                2. <strong>Settings:</strong> Set "Open to Work" (Recruiters Only).<br>
                                3. <strong>Location Hack:</strong> If applying to US Remote, ensure your profile clearly states "Remote / Asynchronous Ready".
                            </div>
                        </div>
                    </div>
                </div>

                <div class="task-item failsafe-task locked" id="tf_3">
                    <div class="task-header" onclick="toggleAccordion(event, 'tf_3')">
                        <div class="check-target" onclick="toggleCheck(event, 'tf_3')"><div class="checkbox"></div></div>
                        <div class="task-title">3. The Global Hunt (USD Targets)</div>
                        <span class="time-tag" style="color:var(--red); border-color:var(--red);">[10 H]</span>
                    </div>
                    <div class="task-details">
                        <div class="target-box" style="border-color:var(--red); color:var(--red); background:rgba(255,42,109,0.05);">TARGET: 50 HIGH-QUALITY APPS</div>
                        <div class="detail-block">
                            <div class="detail-title">WHERE TO FISH</div>
                            <div class="detail-body">
                                Ignore standard boards. Go where the remote-first startups are.<br>
                                1. <strong>Wellfound (AngelList):</strong> Filter for "US/Remote" + "Contract". Great for startups needing one strong architect.<br>
                                2. <strong>Otta:</strong> Filter for "FinTech". Best UI/UX for tech jobs.<br>
                                3. <strong>WeWorkRemotely:</strong> Filter for "Programming/DevOps".
                            </div>
                        </div>
                        <a href="https://wellfound.com/jobs" target="_blank" class="action-link"><div>OPEN WELLFOUND</div> <span>‚Üó</span></a>
                    </div>
                </div>

                <div class="task-item failsafe-task locked" id="tf_4">
                    <div class="task-header" onclick="toggleAccordion(event, 'tf_4')">
                        <div class="check-target" onclick="toggleCheck(event, 'tf_4')"><div class="checkbox"></div></div>
                        <div class="task-title">4. The Portfolio Defense</div>
                        <span class="time-tag" style="color:var(--red); border-color:var(--red);">[15 H]</span>
                    </div>
                    <div class="task-details">
                        <div class="target-box" style="border-color:var(--red); color:var(--red); background:rgba(255,42,109,0.05);">TARGET: 5-SLIDE ARCHITECTURE DECK</div>
                        <div class="detail-block">
                            <div class="detail-title">SHOW, DON'T TELL</div>
                            <div class="detail-body">
                                When they ask "Do you know FSC?", you open this deck.<br>
                                <strong>Slide 1:</strong> The Data Model (Schema Builder screenshot).<br>
                                <strong>Slide 2:</strong> The Automation (Complex Flow screenshot handling NULLs).<br>
                                <strong>Slide 3:</strong> The Security (Sharing Rules matrix).<br>
                                <strong>Slide 4:</strong> The Outcome (Before/After metrics).
                            </div>
                        </div>
                    </div>
                </div>

                <div class="task-item failsafe-task locked" id="tf_5">
                    <div class="task-header" onclick="toggleAccordion(event, 'tf_5')">
                        <div class="check-target" onclick="toggleCheck(event, 'tf_5')"><div class="checkbox"></div></div>
                        <div class="task-title">5. The Interview Script (The Pivot)</div>
                        <span class="time-tag" style="color:var(--red); border-color:var(--red);">[20 H]</span>
                    </div>
                    <div class="task-details">
                        <div class="target-box" style="border-color:var(--red); color:var(--red); background:rgba(255,42,109,0.05);">TARGET: NARRATIVE MASTERY</div>
                        <div class="detail-block">
                            <div class="detail-title">ANSWERING "WHY DID YOU FAIL?"</div>
                            <div class="detail-body">
                                <strong>The Script:</strong> "I operated a boutique technical consultancy. We delivered robust work for [X] Clients, but I realized I prefer the <strong>Architecture & Build</strong> phase (Deep Work) over the <strong>Sales & Admin</strong> cycle. I want to bring that CTO-level technical rigor to a single focused product team."<br>
                                <i>Result: You look like a technical heavyweight, not a failed businessman.</i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="task-item failsafe-task locked" id="tf_6">
                    <div class="task-header" onclick="toggleAccordion(event, 'tf_6')">
                        <div class="check-target" onclick="toggleCheck(event, 'tf_6')"><div class="checkbox"></div></div>
                        <div class="task-title">6. Contractor Setup (Friction Removal)</div>
                        <span class="time-tag" style="color:var(--red); border-color:var(--red);">[2 H]</span>
                    </div>
                    <div class="task-details">
                        <div class="target-box" style="border-color:var(--red); color:var(--red); background:rgba(255,42,109,0.05);">TARGET: "READY TO START" STATUS</div>
                        <div class="detail-block">
                            <div class="detail-title">BE EASY TO HIRE</div>
                            <div class="detail-body">
                                1. <strong>W-8BEN:</strong> Have this filled out. It tells the US IRS you are a foreign contractor (No tax withholding for them).<br>
                                2. <strong>Wise Business:</strong> "I have a US ACH routing number via Wise, so you pay me exactly like a local employee."<br>
                                3. <strong>Async Promise:</strong> "I work 4 hours overlap with EST, 4 hours deep work IST."
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    // --- METADATA & CONFIG ---
    const taskOrder = [
        't0_1','t0_2','t0_3','t0_4','t0_5','t0_6',
        't1_1','t1_2','t1_3','t1_4','t1_5','t1_6','t1_7',
        't2_1','t2_2','t2_3','t2_4',
        't3_1','t3_2','t3_3','t3_4',
        'tf_1', 'tf_2', 'tf_3', 'tf_4', 'tf_5', 'tf_6'
    ];
    
    const taskMeta = {
        't0_1': { phase: 0, obj: 'SECURE WORKSTATION', btn: 'OPEN STEPS', go: 'p0', hrs: 5 },
        't0_2': { phase: 0, obj: 'ADMIN CERTIFICATION', btn: 'OPEN STUDY GUIDE', go: 'p0', hrs: 150 },
        't0_3': { phase: 0, obj: 'SUPERBADGES (EXP)', btn: 'OPEN TRAILHEAD', go: 'p0', hrs: 40 },
        't0_4': { phase: 0, obj: 'DOMAIN FLUENCY', btn: 'READ NASAA', go: 'p0', hrs: 30 },
        't0_5': { phase: 0, obj: 'BUILD DEMO ORG', btn: 'VIEW SPECS', go: 'p0', hrs: 40 },
        't0_6': { phase: 0, obj: 'SYSTEMS & MINDSET', btn: 'READ ATOMIC', go: 'p0', hrs: 15 },
        't1_1': { phase: 1, obj: 'CONTENT LEDGER', btn: 'WRITE ARTICLES', go: 'p1', hrs: 40 },
        't1_2': { phase: 1, obj: 'PARTNER MAPPING', btn: 'OPEN FINDER', go: 'p1', hrs: 20 },
        't1_3': { phase: 1, obj: 'CHANNEL OUTREACH', btn: 'VIEW SCRIPT', go: 'p1', hrs: 100 },
        't1_4': { phase: 1, obj: 'LEGAL INFRA', btn: 'SETUP LLC', go: 'p1', hrs: 10 },
        't1_5': { phase: 1, obj: 'ASSOCIATE CONTRACT', btn: 'NEGOTIATE', go: 'p1', hrs: 20 },
        't1_6': { phase: 1, obj: 'PAYMENT RAILS', btn: 'SETUP WISE', go: 'p1', hrs: 2 },
        't1_7': { phase: 1, obj: 'SALES ENGINEERING', btn: 'RESEARCH', go: 'p1', hrs: 10 },
        't2_1': { phase: 2, obj: 'SOP LIBRARY', btn: 'OPEN NOTION', go: 'p2', hrs: 20 },
        't2_2': { phase: 2, obj: 'ASYNC DELIVERY', btn: 'RECORD LOOM', go: 'p2', hrs: 10 },
        't2_3': { phase: 2, obj: 'HIRE JUNIOR', btn: 'POST JOB', go: 'p2', hrs: 10 },
        't2_4': { phase: 2, obj: 'SYSTEMS ENGINEERING', btn: 'STUDY GITLAB', go: 'p2', hrs: 10 },
        't3_1': { phase: 3, obj: 'MARKET VALIDATION', btn: 'ASK PARTNERS', go: 'p3', hrs: 20 },
        't3_2': { phase: 3, obj: 'MVP SCOPING', btn: 'DEFINE FEATURES', go: 'p3', hrs: 500 },
        't3_3': { phase: 3, obj: 'SECURITY REVIEW', btn: 'RUN CHECKMARX', go: 'p3', hrs: 100 },
        't3_4': { phase: 3, obj: 'FOUNDER MINDSET', btn: 'READ MOM TEST', go: 'p3', hrs: 20 },
        'tf_1': { phase: 4, obj: 'RESUME REWRITE', btn: 'OPEN TEMPLATE', go: 'failsafe', hrs: 5 },
        'tf_2': { phase: 4, obj: 'LINKEDIN SEO', btn: 'OPTIMIZE PROFILE', go: 'failsafe', hrs: 3 },
        'tf_3': { phase: 4, obj: 'GLOBAL JOB HUNT', btn: 'OPEN WELLFOUND', go: 'failsafe', hrs: 10 },
        'tf_4': { phase: 4, obj: 'PORTFOLIO DEFENSE', btn: 'BUILD DECK', go: 'failsafe', hrs: 15 },
        'tf_5': { phase: 4, obj: 'INTERVIEW SCRIPT', btn: 'PRACTICE PIVOT', go: 'failsafe', hrs: 20 },
        'tf_6': { phase: 4, obj: 'CONTRACTOR SETUP', btn: 'SETUP W8BEN', go: 'failsafe', hrs: 2 }
    };

    const phaseConfig = {
        0: { title: 'MASTERY & DOMAIN', sub: '80% SUPERBADGES' },
        1: { title: 'PARTNER CHANNEL', sub: '80% OUTREACH' },
        2: { title: 'DELIVERY OS', sub: '0% CHAOS' },
        3: { title: 'PRODUCT', sub: '80% ROADMAP' },
        4: { title: 'CAREER PIVOT', sub: 'EMERGENCY PROTOCOL' }
    };

    // --- NAVIGATION & INTERCEPTION ---
    let pendingDestination = null;

    function go(id, closeMenu = true) {
        const isFailsafeActive = document.body.classList.contains('failsafe-active');
        const targetIsFailsafe = (id === 'failsafe');

        // 1. INTERCEPTION LOGIC
        if (isFailsafeActive && !targetIsFailsafe) {
            // Trying to LEAVE Failsafe -> Confirm First
            pendingDestination = id;
            showModal('exit');
            if(closeMenu) toggleSidebar(false);
            return; // STOP execution
        } 
        
        if (!isFailsafeActive && targetIsFailsafe) {
            // Trying to ENTER Failsafe -> Confirm First
            pendingDestination = id;
            showModal('enter');
            if(closeMenu) toggleSidebar(false);
            return; // STOP execution
        }
        
        // 2. STANDARD NAVIGATION (If checks pass)
        executeNavigation(id, closeMenu);
    }

    // Called strictly via the Sidebar "FAILSAFE" button
    function requestFailsafeToggle() {
        const isFailsafeActive = document.body.classList.contains('failsafe-active');
        
        if (isFailsafeActive) {
            // User clicked Failsafe button while IN Failsafe -> Just close menu, do nothing else
            toggleSidebar(false);
        } else {
            // User wants to ENTER Failsafe -> Trigger Confirmation
            pendingDestination = 'failsafe';
            showModal('enter');
            toggleSidebar(false);
        }
    }

    function executeNavigation(id, closeMenu) {
        const isFailsafeTarget = (id === 'failsafe');
        const wasFailsafeActive = document.body.classList.contains('failsafe-active');
        
        // Animation Direction
        let animClass = 'fade-in';
        if (isFailsafeTarget) animClass = 'slide-enter-right';
        else if (wasFailsafeActive && !isFailsafeTarget) animClass = 'slide-enter-left';

        // Hide all sections
        document.querySelectorAll('.section').forEach(el => {
            el.classList.remove('active', 'slide-enter-right', 'slide-enter-left', 'fade-in');
        });
        
        // Activate Target
        const target = document.getElementById(id);
        target.classList.add(animClass);
        void target.offsetWidth; // Force Reflow
        target.classList.add('active');
        
        // Sidebar Highlights
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        if (!isFailsafeTarget) {
             const btns = document.querySelectorAll('.nav-btn');
             btns.forEach(btn => {
                const attr = btn.getAttribute('onclick');
                if(attr && attr.includes(`go('${id}')`)) btn.classList.add('active');
            });
        }

        // Mission Control Button Glow Logic
        const dbBtns = document.querySelectorAll('.db-btn');
        if (id === 'dashboard') {
            dbBtns.forEach(btn => btn.classList.add('active'));
        } else {
            dbBtns.forEach(btn => btn.classList.remove('active'));
        }

        document.querySelector('.scroll-area').scrollTo({ top: 0, behavior: 'smooth' });

        // Phase Title Update
        const phaseTitle = isFailsafeTarget ? "EMERGENCY PROTOCOL" : "SYSTEM ACTIVE";
        document.getElementById('current_phase_title').innerText = phaseTitle;

        if(closeMenu) {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('sidebar_overlay').classList.remove('active');
        }
        
        updateHUD();
    }

    // --- MODAL LOGIC ---
    function showModal(type) {
        const modal = document.getElementById('modal_overlay');
        const box = document.getElementById('modal_box');
        const title = document.getElementById('modal_title');
        const txt = document.getElementById('modal_txt');
        const btn = document.getElementById('modal_confirm_btn');

        modal.classList.add('active');
        
        // Reset classes
        box.classList.remove('danger', 'standard');
        btn.classList.remove('confirm-danger', 'confirm-standard');

        if (type === 'enter') {
            // ENTERING FAILSAFE (Red Warning)
            box.classList.add('danger');
            title.innerText = "WARNING: PROTOCOL PIVOT";
            txt.innerHTML = "You are activating <strong>FAILSAFE MODE</strong>.<br>This assumes the primary mission has failed.<br>Do you wish to proceed?";
            btn.innerText = "ACTIVATE FAILSAFE";
            btn.classList.add('confirm-danger');
            btn.onclick = function() {
                document.body.classList.add('failsafe-active'); // Enable Red
                executeNavigation('failsafe', false);
                closeModal();
            };
        } else {
            // LEAVING FAILSAFE (Standard Return)
            box.classList.add('standard');
            title.innerText = "SECURITY ALERT";
            txt.innerHTML = "You are exiting Emergency Protocol.<br>Returning to <strong>MISSION CONTROL</strong>.<br>Confirm restore?";
            btn.innerText = "RESTORE SYSTEMS";
            btn.classList.add('confirm-standard');
            btn.onclick = function() {
                document.body.classList.remove('failsafe-active'); // Disable Red
                executeNavigation(pendingDestination, false);
                closeModal();
            };
        }
    }

    function closeModal() {
        document.getElementById('modal_overlay').classList.remove('active');
        pendingDestination = null;
    }

    // --- CORE UI ---
    function toggleSidebar(forceState) { 
        const sb = document.getElementById('sidebar');
        const ov = document.getElementById('sidebar_overlay');
        
        if (forceState === false) {
            sb.classList.remove('active');
            ov.classList.remove('active');
        } else {
            sb.classList.toggle('active'); 
            ov.classList.toggle('active');
        }
    }

    function toggleTheme() { document.body.classList.toggle('light-mode'); }
    
    // --- ACCORDION LOGIC (ONE OPEN, OTHERS CLOSE) ---
    function toggleAccordion(e, id) { 
        // 1. Get current state of clicked item
        const clickedEl = document.getElementById(id);
        const isAlreadyOpen = clickedEl.classList.contains('open');
        
        // 2. Identify the container (Phase/Section)
        const parentSection = clickedEl.closest('.section');
        
        // 3. Close ALL open tasks in this section
        if (parentSection) {
            const allTasks = parentSection.querySelectorAll('.task-item');
            allTasks.forEach(task => {
                task.classList.remove('open');
            });
        }
        
        // 4. Re-open clicked one if it wasn't already open
        if (!isAlreadyOpen) {
            clickedEl.classList.add('open');
        }
        
        // 5. Scroll logic (optional but nice)
        if(!isAlreadyOpen) {
            setTimeout(() => {
                clickedEl.scrollIntoView({behavior:'smooth', block:'center'});
            }, 100);
        }
    }

    // --- GATEKEEPER & DATA ---
    function checkGatekeeper() {
        const checks = document.querySelectorAll('#failsafe_gatekeeper input[type="checkbox"]');
        const allChecked = Array.from(checks).every(c => c.checked);
        const content = document.getElementById('failsafe_content');
        const gatekeeper = document.getElementById('failsafe_gatekeeper');
        
        if (allChecked) {
            content.classList.add('unlocked');
            gatekeeper.classList.add('minimized');
        } else {
            content.classList.remove('unlocked');
            gatekeeper.classList.remove('minimized');
            // PUNISHMENT: WIPE
            ['tf_1', 'tf_2', 'tf_3', 'tf_4', 'tf_5', 'tf_6'].forEach(id => {
                const el = document.getElementById(id);
                if(el && el.classList.contains('completed')) {
                    el.classList.remove('completed');
                    localStorage.setItem('capital_v17_' + id, 'false');
                }
            });
            updateHUD();
        }
        saveState();
    }
    
    document.getElementById('failsafe_gatekeeper').addEventListener('click', function(e) {
        if(this.classList.contains('minimized') && e.target.type !== 'checkbox') {
             if(confirm("WARNING: Re-verifying constraints will WIPE Failsafe progress. Proceed?")) {
                this.classList.remove('minimized');
                document.querySelectorAll('#failsafe_gatekeeper input').forEach(c => c.checked = false);
                checkGatekeeper();
            }
        }
    });

    // --- LOGIC & AUTO-ADVANCE ---
    function checkLocks() {
        let isPreviousComplete = true; 
        for (let i = 0; i < taskOrder.length; i++) {
            const taskId = taskOrder[i];
            const el = document.getElementById(taskId);
            let isLocked = false;
            
            if(taskId.startsWith('tf_')) {
                 const fsIndex = ['tf_1','tf_2','tf_3','tf_4','tf_5','tf_6'].indexOf(taskId);
                 if(fsIndex > 0) {
                     const prevFsId = ['tf_1','tf_2','tf_3','tf_4','tf_5','tf_6'][fsIndex - 1];
                     if(!document.getElementById(prevFsId).classList.contains('completed')) isLocked = true;
                 }
            } else {
                if (!isPreviousComplete) isLocked = true;
            }

            if (isLocked) {
                el.classList.add('locked');
                el.setAttribute('title', `LOCKED: Complete previous task first.`);
            } else {
                el.classList.remove('locked');
                el.removeAttribute('title');
            }
            
            if (!taskId.startsWith('tf_') && !el.classList.contains('completed')) isPreviousComplete = false;
        }
    }

    function toggleCheck(e, id) {
        e.stopPropagation();
        const el = document.getElementById(id);
        
        if(el.classList.contains('locked')) {
            el.style.borderColor = 'var(--red)';
            setTimeout(() => el.style.borderColor = 'var(--border)', 300);
            return;
        }

        const isComplete = el.classList.toggle('completed');
        
        // AUTO-COLLAPSE & ADVANCE
        if (isComplete) {
            // Close the current one immediately on completion
            el.classList.remove('open');
            
            // Wait for DOM update then find next
            const idx = taskOrder.indexOf(id);
            if(idx > -1 && idx < taskOrder.length - 1) {
                const nextId = taskOrder[idx + 1];
                // Only auto-open if in same context
                const currentIsFailsafe = id.startsWith('tf_');
                const nextIsFailsafe = nextId.startsWith('tf_');
                
                if (currentIsFailsafe === nextIsFailsafe) {
                    setTimeout(() => {
                        checkLocks();
                        const nextEl = document.getElementById(nextId);
                        if(!nextEl.classList.contains('locked')) {
                            // Close everything in section first (safety)
                            const parent = nextEl.closest('.section');
                            if(parent) parent.querySelectorAll('.task-item').forEach(t=>t.classList.remove('open'));
                            
                            // Open next
                            nextEl.classList.add('open');
                            nextEl.scrollIntoView({behavior:'smooth', block:'center'});
                        }
                    }, 50);
                }
            }
        } else {
            // Uncheck Logic
            const index = taskOrder.indexOf(id);
            for(let i = index + 1; i < taskOrder.length; i++) {
                if(id.startsWith('tf_') && taskOrder[i].startsWith('tf_')) {
                     document.getElementById(taskOrder[i]).classList.remove('completed');
                } else if (!id.startsWith('tf_') && !taskOrder[i].startsWith('tf_')) {
                    document.getElementById(taskOrder[i]).classList.remove('completed');
                }
            }
        }

        saveState();
        updateHUD();
        checkLocks();
    }

    function updateHUD() {
        let totalHrs = 0;
        let activePhase = 0;
        let foundActive = false;

        // Iterate through Phases 0-3
        for(let i=0; i<=3; i++) {
            const tasks = Object.keys(taskMeta).filter(k => taskMeta[k].phase === i);
            let done = 0;
            tasks.forEach(tid => {
                if(document.getElementById(tid).classList.contains('completed')) {
                    done++;
                    totalHrs += taskMeta[tid].hrs;
                }
            });
            const pct = tasks.length > 0 ? Math.round((done / tasks.length) * 100) : 0;
            
            // Sidebar Progress Bars
            const bar = document.getElementById(`bar_p${i}`);
            const txt = document.getElementById(`txt_p${i}`);
            const navTxt = document.getElementById(`nav_p${i}`); // NEW: Target Sidebar Tag
            
            if(bar) bar.style.width = pct + '%';
            if(txt) txt.innerText = pct + '%';
            if(navTxt) navTxt.innerText = pct + '%';

            if (!foundActive && pct < 100) { activePhase = i; foundActive = true; }
        }
        
        if(!foundActive) activePhase = 3;
        
        // Check real body class for failsafe state
        const isFailsafeMode = document.body.classList.contains('failsafe-active');
        if(isFailsafeMode) activePhase = 4;

        const focusData = phaseConfig[activePhase];
        if(focusData) {
            const valEl = document.getElementById('hud_focus_val');
            const subEl = document.getElementById('hud_focus_sub');
            valEl.innerText = focusData.title;
            subEl.innerText = focusData.sub;
            
            // STRICT COLOR RESET
            if(activePhase === 4) {
                 valEl.style.color = 'var(--red)';
            } else {
                 valEl.style.color = 'var(--cyan)';
            }
        }

        // Integrity
        const mainTasks = taskOrder.filter(id => !id.startsWith('tf_'));
        let completed = 0;
        mainTasks.forEach(id => { if(document.getElementById(id).classList.contains('completed')) completed++; });
        document.getElementById('sys_integrity').innerText = Math.round((completed / mainTasks.length) * 100) + "%";

        document.getElementById('hud_hours').innerText = totalHrs + " / 1000 H";

        let nextTask;
        if (activePhase === 4) {
             nextTask = taskOrder.find(id => id.startsWith('tf_') && !document.getElementById(id).classList.contains('completed'));
        } else {
             nextTask = taskOrder.find(id => !document.getElementById(id).classList.contains('completed') && !id.startsWith('tf_'));
        }
        
        const hudLbl = document.getElementById('hud_obj_label');
        const hudTxt = document.getElementById('hud_obj_text');
        const hudBtn = document.getElementById('hud_action');

        if (nextTask) {
            const meta = taskMeta[nextTask];
            hudLbl.innerText = "OBJECTIVE // " + (activePhase === 4 ? "EMERGENCY" : (meta.phase === 0 ? "GENESIS" : "EXECUTION"));
            hudTxt.innerText = meta.obj;
            hudBtn.innerText = meta.btn;
            
            // Strict Button Assignment
            hudBtn.onclick = function() {
                // If in Failsafe, but objective is NOT failsafe (rare state bug), force exit
                if(activePhase === 4 && !meta.go.includes('failsafe')) {
                     go(meta.go, false); // This triggers modal
                } 
                // If NOT in Failsafe, but objective IS failsafe (user failed everything), force enter
                else if(activePhase !== 4 && meta.go === 'failsafe') {
                     pendingDestination = 'failsafe'; showModal('enter');
                }
                else {
                    // Normal nav within same context
                    go(meta.go, false); 
                    setTimeout(() => { 
                        const el = document.getElementById(nextTask);
                        if(el) {
                            el.scrollIntoView({behavior:'smooth', block:'center'}); 
                            if(!el.classList.contains('open')) toggleAccordion(null, nextTask);
                        }
                    }, 300);
                }
            };
            
            // STRICT COLOR RESET
            if(activePhase === 4) {
                hudLbl.style.color = 'var(--red)';
                hudBtn.style.background = 'var(--red)';
                hudBtn.style.color = '#fff';
            } else {
                hudLbl.style.color = 'var(--cyan)';
                hudBtn.style.background = 'var(--cyan)';
                hudBtn.style.color = '#000';
            }

        } else if (activePhase === 4) {
             hudLbl.innerText = "STATUS"; hudTxt.innerText = "PIVOT COMPLETE"; hudBtn.innerText = "GOOD LUCK";
        } else {
             hudLbl.innerText = "SYSTEM STATUS"; hudTxt.innerText = "ALL SYSTEMS GO"; hudBtn.innerText = "RESET SYSTEM";
             hudBtn.onclick = function() { if(confirm('Reset all progress?')) { localStorage.clear(); location.reload(); }};
             hudLbl.style.color = 'var(--cyan)';
             hudBtn.style.background = 'var(--cyan)';
        }
    }

    function saveState() {
        taskOrder.forEach(id => localStorage.setItem('capital_v17_' + id, document.getElementById(id).classList.contains('completed')));
        document.querySelectorAll('#failsafe_gatekeeper input').forEach((c, i) => localStorage.setItem('capital_v17_failcheck_' + i, c.checked));
    }

    function loadState() {
        taskOrder.forEach(id => {
            if(localStorage.getItem('capital_v17_' + id) === 'true') document.getElementById(id).classList.add('completed');
        });
        const checks = document.querySelectorAll('#failsafe_gatekeeper input');
        checks.forEach((c, i) => {
            if(localStorage.getItem('capital_v17_failcheck_' + i) === 'true') c.checked = true;
        });
        if (Array.from(checks).every(c => c.checked) && checks.length > 0) {
             document.getElementById('failsafe_content').classList.add('unlocked');
             document.getElementById('failsafe_gatekeeper').classList.add('minimized');
        }
        checkLocks();
        updateHUD();
        
        // Initialize Dashboard Button State
        document.querySelectorAll('.db-btn').forEach(btn => btn.classList.add('active'));
    }

    function ftab(e, id) {
        document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.c-tab').forEach(el => el.classList.remove('active'));
        document.getElementById(id).style.display = 'block';
        if(e && e.target) e.target.classList.add('active');
    }
    
    function c1() { 
        let wk = parseFloat(document.getElementById('in_f1_rate').value) * parseFloat(document.getElementById('in_f1_hrs').value);
        document.getElementById('out_f1_wk').innerText = '$' + wk.toLocaleString(); 
        document.getElementById('out_f1_mo').innerText = '$' + (wk*4).toLocaleString();
        document.getElementById('out_f1_yr').innerText = '$' + (wk*48).toLocaleString(); 
    }
    function c2() { 
        let ret = parseFloat(document.getElementById('in_f2_ret').value) * parseFloat(document.getElementById('in_f2_cli').value);
        let proj = parseFloat(document.getElementById('in_f2_proj').value) * parseFloat(document.getElementById('in_f2_pcount').value);
        let cost = (parseFloat(document.getElementById('in_f2_staff').value) * parseFloat(document.getElementById('in_f2_sal').value)) + parseFloat(document.getElementById('in_f2_ads').value);
        document.getElementById('out_f2_rev').innerText = '$' + (ret+proj).toLocaleString();
        document.getElementById('out_f2_cost').innerText = '-$' + cost.toLocaleString();
        document.getElementById('out_f2_net').innerText = '$' + (ret+proj-cost).toLocaleString();
        document.getElementById('out_f2_run').innerText = '$' + ((ret+proj)*12).toLocaleString();
    }
    function c3() { 
        let arr = parseFloat(document.getElementById('in_f3_lic').value) * parseFloat(document.getElementById('in_f3_users').value);
        document.getElementById('out_f3_arr').innerText = '$' + (arr/1000000).toFixed(2) + 'M';
        document.getElementById('out_f3_exit').innerText = '$' + ((arr * parseFloat(document.getElementById('in_f3_mult').value))/1000000).toFixed(2) + 'M'; 
    }

    window.onload = function() {
        loadState(); c1(); c2(); c3();
        setInterval(() => {
            document.getElementById('clock_nyc').innerText = new Date().toLocaleTimeString('en-US', {timeZone:'America/New_York', hour12: false, hour: '2-digit', minute:'2-digit', second:'2-digit'});
            document.getElementById('clock_ist').innerText = new Date().toLocaleTimeString('en-US', {timeZone:'Asia/Kolkata', hour12: false, hour: '2-digit', minute:'2-digit', second:'2-digit'});
        }, 1000);
    }
</script>
</body>
</html>
